# 設定画面拡充 — 開発計画書

**作成日**: 2026-02-13
**ステータス**: ドラフト v1.1（セルフチェック反映済み）
**参考資料**: Canva設定画面 (01〜08 PDF) + MenuCraft AI 既存機能分析

---

## 1. 背景と目的

### 1.1 現状の設定画面

現在の `/settings` は以下4セクションのみ:

| セクション | 状態 |
|-----------|------|
| プロフィール（店舗名・メール・登録日） | ✅ 実装済み |
| プラン表示 + 変更リンク | ✅ 実装済み |
| パスワード変更 | ✅ 実装済み（`PasswordChangeForm` コンポーネント + `PATCH /api/account` で対応） |
| 退会 | ✅ 実装済み |

### 1.2 課題

- **毎回同じ情報をチャットで入力**: 業態・コンセプト・ブランドカラーなどをセッションごとに聞かれる
- **生成体験のカスタマイズ不可**: デフォルトのサイズやスタイルを設定できない
- **通知・プライバシー管理なし**: ギャラリー公開やAI学習の制御ができない
- **使用状況の不透明さ**: Free プランの残枠やストレージ使用量が見えない
- **セキュリティの拡充余地**: パスワード変更は実装済みだが、全デバイスログアウト・データエクスポートがない

### 1.3 目的

飲食店オーナーが**自分の店舗情報を一度設定すれば、以降のチャット・画像生成がスムーズになる**体験を実現する。Canvaの設定構造を参考にしつつ、MenuCraft AI固有の価値（店舗プロフィール・生成デフォルト）を中心に設計する。

---

## 2. 設定セクション一覧

### 2.1 全体構成

| # | セクション | Canva相当 | Tier | 概要 |
|---|-----------|----------|------|------|
| S-01 | 店舗プロフィール | 01_プロフィール | 1 | 店舗写真・業態・コンセプト・ブランドカラー |
| S-02 | 画像生成デフォルト | （MenuCraft固有） | 1 | デフォルトサイズ・スタイル・出力言語 |
| S-03 | セキュリティ | 02_ログイン | 2 | パスワード変更・全デバイスログアウト |
| S-04 | 通知設定 | 04_メッセージ環境設定 | 2 | メール通知・アプリ内通知の制御 |
| S-05 | 使用状況 | 08_使用状況レポート | 2 | 生成数・セッション数・ストレージ |
| S-06 | 表示設定 | 03_アクセシビリティ | 3 | テーマ（ライト/ダーク）・アニメーション |
| S-07 | プライバシー | 05_プライバシー設定 | 3 | AI学習・ギャラリー公開デフォルト |
| S-08 | 請求 | 06_請求 + 07_注文 | 4 | Stripe連携後に実装 |

---

## 3. Tier 1 — 店舗プロフィール + 画像生成デフォルト

> サービスの核心。毎回のチャット体験・画像生成品質に直結する。

### S-01: 店舗プロフィール

**目的**: 一度設定すれば、チャット開始時にAIが店舗情報を把握済みの状態でスタートできる。

| 項目 | 型 | 必須 | 説明 |
|------|-----|------|------|
| プロフィール写真 | 画像 | 任意 | ギャラリー・チャットのアバターに使用 |
| 店舗名 | テキスト | ✅ | 既存の `name` カラムを利用 |
| 業態 | セレクト | 任意 | 居酒屋/カフェ/フレンチ/イタリアン/和食/中華/ラーメン/焼肉/その他 |
| 店舗コンセプト | テキストエリア | 任意 | 自由記述（200文字以内）例:「路地裏の隠れ家フレンチ」 |
| ブランドカラー（メイン） | カラーピッカー | 任意 | HEX値。画像生成プロンプトに反映 |
| ブランドカラー（サブ） | カラーピッカー | 任意 | HEX値。補助色 |
| 所在地（都道府県） | セレクト | 任意 | 将来的なエリア分析用 |
| WebサイトURL | テキスト | 任意 | LP等へのリンク |
| SNSアカウント | テキスト | 任意 | Instagram / X のハンドル |

**チャットへの連携イメージ**:
```
従来: 🤖「店名を教えてください」→「業態は？」→「コンセプトは？」→「カラーは？」(4ターン)
改善: 🤖「さくらカフェ様、ナチュラルテイストのカフェですね。今日はどんなメニュー画像を作りましょうか？」(0ターン)
```

### S-02: 画像生成デフォルト

**目的**: 生成のたびにサイズやスタイルを選ぶ手間を省く。

| 項目 | 型 | デフォルト値 | 説明 |
|------|-----|------------|------|
| デフォルト画像サイズ | チェックボックス群 | 1:1 のみ | 1:1 / 9:16 / 16:9 から複数選択 |
| デフォルトスタイル | セレクト | 指定なし | ポップ/シック/和風/モダン/ナチュラル/ミニマル |
| テキスト表示言語 | セレクト | 日本語 | 画像内テキストの言語 |
| 写真スタイル | セレクト | 指定なし | リアル/イラスト/水彩風/フラットデザイン |

**Free/Pro の差分**:
- Free: デフォルトサイズは 1:1 固定（変更不可、Proへの誘導表示）
- Pro: 全サイズ選択可能

---

## 4. Tier 2 — セキュリティ + 通知 + 使用状況

> 基本的なアカウント管理。ユーザーの安心感と利便性。

### S-03: セキュリティ

| 項目 | 説明 |
|------|------|
| パスワード変更 | ✅ 実装済み（`PasswordChangeForm` + `PATCH /api/account`）。UIリフレッシュのみ |
| 全デバイスからのログアウト | 全セッション無効化（JWTの `iat` チェック） |
| データダウンロード | 生成画像の一括ZIPエクスポート |
| アカウント作成日 | 表示のみ（既存） |

### S-04: 通知設定

| 項目 | デフォルト | 説明 |
|------|----------|------|
| 新機能のお知らせ | ON | サービスアップデート情報 |
| 画像生成完了 | ON | 生成完了時のブラウザ通知 |
| ギャラリーの反応 | ON | いいね・保存された時 |
| マーケティングメール | OFF | キャンペーン等 |
| メール受信頻度 | リアルタイム | リアルタイム/日次まとめ/週次まとめ |

### S-05: 使用状況

| 項目 | 説明 |
|------|------|
| 今日の画像生成数 | プログレスバー（Free: x/3枚/日、Pro: 無制限） |
| 今月のセッション数 | プログレスバー（Free: x/3件/月） |
| 累計生成画像数 | 総数表示 |
| ストレージ使用量 | MB単位（Supabase Storage） |
| API使用ログ（直近） | 簡易テーブル（日別の生成数推移） |

---

## 5. Tier 3 — 表示設定 + プライバシー

> あると良いが、コア体験には影響しない。

### S-06: 表示設定

| 項目 | 選択肢 | 説明 |
|------|--------|------|
| テーマ | システムと同期 / ライト / ダーク | CSS変数の切り替え |
| アニメーション | ON / OFF | fadeInUp等の制御 |
| 言語 | 日本語 / English | UI言語（Phase 3で本格対応） |

### S-07: プライバシー

| 項目 | デフォルト | 説明 |
|------|----------|------|
| AI学習へのデータ提供 | ON | アップロード画像・チャット内容のGemini学習利用 |
| ギャラリー公開時の店名表示 | ON | 共有画像に店舗名を表示するか |
| 使用状況データの共有 | ON | サービス改善目的の匿名利用データ |

---

## 6. Tier 4 — 請求（Stripe連携後）

> Phase 3 のStripe決済連携が完了してから実装。

### S-08: 請求

| 項目 | 説明 |
|------|------|
| 現在のプラン | Free / Pro 表示 + アップグレード/ダウングレードCTA |
| 支払い方法 | クレジットカード情報（Stripe Elements） |
| 請求履歴 | 月次の請求一覧（Stripe Invoice API） |
| プランキャンセル | サブスクリプション解約フロー |

---

## 7. UI設計方針

### 7.1 レイアウト

既存の `AppLayout`（サイドバー + コンテンツ）を使用。設定画面内は以下の構成:

```
┌─────────────────────────────────────────────────────┐
│ AppLayout (サイドバー + ヘッダー)                      │
├──────────┬──────────────────────────────────────────┤
│ Settings │  設定コンテンツ                             │
│ Sidenav  │                                          │
│          │  ┌────────────────────────────────────┐  │
│ ○ プロフィール│  │ セクションカード                     │  │
│ ○ 生成設定  │  │ (既存デザインパターン踏襲)           │  │
│ ○ セキュリティ│  └────────────────────────────────────┘  │
│ ○ 通知     │                                          │
│ ○ 使用状況  │  ┌────────────────────────────────────┐  │
│ ○ 表示     │  │ 次のセクション                       │  │
│ ○ プライバシー│  └────────────────────────────────────┘  │
│ ○ 退会     │                                          │
├──────────┴──────────────────────────────────────────┤
```

### 7.2 デザイントークン

既存の Phase A〜C デザインパターンを踏襲:
- 背景ブラーサークル（opacity .04）
- アクセントバー（セクション上端 2px）
- 英語ラベル（tracking-[1.5px]）
- ホバーエフェクト
- rounded-[20px] カード

### 7.3 保存方式

- **即時保存（トグル系）**: 通知ON/OFF、プライバシー設定 → 変更即反映
- **明示的保存（フォーム系）**: プロフィール、生成デフォルト → 「保存」ボタン押下で反映
- **確認モーダル（破壊的操作）**: パスワード変更、退会、データ削除

---

## 8. 開発スケジュール

| Tier | セクション | 見積もり | 依存関係 |
|------|-----------|---------|---------|
| **Tier 1** | S-01 店舗プロフィール | 1セッション | DBマイグレーション必要 |
| **Tier 1** | S-02 画像生成デフォルト | 1セッション | S-01と同時実装可 |
| **Tier 2** | S-03 セキュリティ | 1セッション | なし |
| **Tier 2** | S-04 通知設定 | 1セッション | DBマイグレーション必要 |
| **Tier 2** | S-05 使用状況 | 0.5セッション | 既存データ活用 |
| **Tier 3** | S-06 表示設定 | 1セッション | CSS変数対応 |
| **Tier 3** | S-07 プライバシー | 0.5セッション | DBマイグレーション必要 |
| **Tier 4** | S-08 請求 | 2セッション | Stripe連携が前提 |

**合計**: 約7〜8セッション（Tier 4除く）

---

## 9. 成功指標

| 指標 | 目標 |
|------|------|
| プロフィール設定完了率 | 登録ユーザーの60%以上 |
| チャット初期ターン数の削減 | 平均4ターン → 1ターン |
| 画像生成デフォルト設定率 | アクティブユーザーの40%以上 |
| 設定画面の離脱率 | 30%未満 |

---

*本計画書はドラフトです。レビュー・フィードバックを反映して更新します。*
