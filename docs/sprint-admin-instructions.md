# Sprint Aï¼ˆAdminæ‹¡å…… + ç™»éŒ²æ”¹å–„ï¼‰â€” æ¥­å‹™æŒ‡ç¤ºæ›¸

**ä½œæˆæ—¥**: 2026-02-13
**å¯¾è±¡**: ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `/Users/arumamurata/claude/any_menucraft_AI/menucraft-web`
**ãƒ–ãƒ©ãƒ³ãƒ**: `develop` ã‹ã‚‰ `feature/admin-enhancement` ã‚’ä½œæˆã—ã¦ä½œæ¥­
**å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- `CLAUDE.md` â€” ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚¬ã‚¤ãƒ‰
- `src/app/admin/` â€” æ—¢å­˜adminç”»é¢ï¼ˆ7ç”»é¢ï¼‰
- `src/components/admin/` â€” KpiCard, TrendChart, CompletionDonut, RecentSessionsTable, ApiHealthIndicator
- `src/lib/admin-auth.ts` â€” adminèªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼
- `src/lib/rate-limiter.ts` â€” æ—¢å­˜ãƒ¬ãƒ¼ãƒˆåˆ¶é™

---

## æ¦‚è¦

æœ¬Sprintã§ã¯ä»¥ä¸‹ã®3è»¸ã§ä½œæ¥­ã‚’è¡Œã†:

| è»¸ | ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ |
|----|--------|:---:|
| **Adminæ–°è¦ç”»é¢** | ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + å£²ä¸Šç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | é«˜ |
| **Adminæ—¢å­˜æ”¹ä¿®** | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰KPIæ‹¡å¼µ + ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°æ‹¡å¼µ + APIãƒ­ã‚°æ”¹å–„ | ä¸­ |
| **ç™»éŒ²ãƒ•ãƒ­ãƒ¼æ”¹å–„** | Rate limiter + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ•´ç† + ç™»éŒ²å¾Œå°ç·š | ä¸­ |

**ä½œæ¥­é †åº**: Task 1 â†’ 2 â†’ 3 â†’ 4 â†’ 5 â†’ 6 â†’ 7ï¼ˆæ™‚é–“ä¸è¶³ã®å ´åˆã€Task 5ãƒ»7ã¯æ¬¡å›é€ã‚Šå¯ï¼‰

---

## Task 1: ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ï¼ˆå„ªå…ˆåº¦: æœ€é«˜ï¼‰

### èƒŒæ™¯
ã‚®ãƒ£ãƒ©ãƒªãƒ¼æ©Ÿèƒ½ï¼ˆå…¬é–‹ãƒ»ã„ã„ã­ãƒ»ä¿å­˜ãƒ»é€šå ±ï¼‰ã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€`image_reports` ãƒ†ãƒ¼ãƒ–ãƒ«ã«æºœã¾ã£ãŸé€šå ±ã‚’ç¢ºèªãƒ»å¯¾å¿œã™ã‚‹admin UIãŒãªã„ã€‚UGCã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¯å¿…é ˆã€‚

### 1-1. APIä½œæˆ: `GET /api/admin/moderation`

```typescript
// ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
// page: number (default 1, 20ä»¶/ãƒšãƒ¼ã‚¸)

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  reports: Array<{
    id: string;
    shared_image_id: string;
    image_url: string;         // Supabase Storage URL
    image_category: string;
    reporter_email: string;    // é€šå ±è€…
    uploader_email: string;    // æŠ•ç¨¿è€…
    uploader_id: string;
    reason: string;            // "inappropriate" | "spam" | "other"
    detail: string | null;
    created_at: string;        // é€šå ±æ—¥æ™‚
    image_created_at: string;  // ç”»åƒå…¬é–‹æ—¥æ™‚
    like_count: number;
    save_count: number;
  }>;
  stats: {
    total_reports: number;
    pending_reports: number;
    total_shared_images: number;
  };
  pagination: {
    page: number;
    total_pages: number;
    total_count: number;
  };
}
```

- `image_reports` ã‚’ `shared_images`, `generated_images`, `users` ã¨JOINã—ã¦å–å¾—
- æœ€æ–°é †ã‚½ãƒ¼ãƒˆ

### 1-2. APIä½œæˆ: `POST /api/admin/moderation/[id]`

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
{ action: "remove" | "dismiss" }

// remove: shared_images ã‹ã‚‰è©²å½“ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ˆStorageä¸Šã®ç”»åƒã¯æ®‹ã™ï¼‰
// dismiss: image_reports ã®è©²å½“ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ˆå•é¡Œãªã—ã¨åˆ¤æ–­ï¼‰

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{ message: "å¯¾å¿œã—ã¾ã—ãŸã€‚" }
```

### 1-3. ãƒšãƒ¼ã‚¸ä½œæˆ: `/admin/moderation/page.tsx`

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
- ä¸Šéƒ¨: çµ±è¨ˆã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰3ã¤ï¼ˆå…¨é€šå ±æ•° / æœªå¯¾å¿œ / å…¨å…¬é–‹ç”»åƒæ•°ï¼‰
- ãƒ¡ã‚¤ãƒ³: é€šå ±ã‚«ãƒ¼ãƒ‰ä¸€è¦§
  - å„ã‚«ãƒ¼ãƒ‰: ç”»åƒã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆå·¦ï¼‰+ æƒ…å ±ï¼ˆå³: é€šå ±ç†ç”±ãƒãƒƒã‚¸ãƒ»é€šå ±è€…ãƒ»æŠ•ç¨¿è€…ãƒ»æ—¥æ™‚ï¼‰
  - é€šå ±ç†ç”±ãƒãƒƒã‚¸è‰²: inappropriate=èµ¤, spam=ã‚ªãƒ¬ãƒ³ã‚¸, other=ã‚°ãƒ¬ãƒ¼
  - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³: ã€Œç”»åƒã‚’éå…¬é–‹ã«ã™ã‚‹ã€ï¼ˆèµ¤ï¼‰/ã€Œå•é¡Œãªã—ã€ï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰
  - ã€Œç”»åƒã‚’éå…¬é–‹ã«ã™ã‚‹ã€ã¯ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ä»˜ã
- ä¸‹éƒ¨: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

**ãƒ‡ã‚¶ã‚¤ãƒ³:** æ—¢å­˜adminç”»é¢ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¸è¥²ï¼ˆbg-bg-secondary ã‚«ãƒ¼ãƒ‰ã€accent-warm ãƒ˜ãƒƒãƒ€ãƒ¼ç­‰ï¼‰

### 1-4. ã‚µã‚¤ãƒ‰ãƒŠãƒ“æ›´æ–°
- adminã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã€Œãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’è¿½åŠ 
- æœªå¯¾å¿œé€šå ± â‰¥ 1 ã®å ´åˆã€ä»¶æ•°ãƒãƒƒã‚¸ï¼ˆèµ¤ä¸¸ï¼‰ã‚’è¡¨ç¤º

---

## Task 2: å£²ä¸Šç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

### èƒŒæ™¯
Stripeé€£æºã¯ã¾ã ã ãŒã€ãƒ—ãƒ©ãƒ³åˆ†å¸ƒãƒ»æ¨å®šåç›Šãƒ»è»¢æ›ç‡ãƒ»å®šç€ç‡ãªã©ã®ã€Œå£²ä¸Šã«ç¹‹ãŒã‚‹æŒ‡æ¨™ã€ã‚’å¯è¦–åŒ–ã™ã‚‹ã€‚Stripeå°å…¥å¾Œã«å®Ÿãƒ‡ãƒ¼ã‚¿ã«å·®ã—æ›¿ãˆå¯èƒ½ãªè¨­è¨ˆã«ã™ã‚‹ã€‚

### 2-1. APIä½œæˆ: `GET /api/admin/revenue`

```typescript
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  // ãƒ—ãƒ©ãƒ³åˆ†å¸ƒ
  plan_distribution: {
    free: number;    // Freeãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
    pro: number;     // Proãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼ˆç¾æ™‚ç‚¹ã§ã¯0æƒ³å®šï¼‰
    total: number;
  },

  // æ¨å®šMRR
  estimated_mrr: number,  // pro Ã— 700ï¼ˆå††ï¼‰

  // è»¢æ›æŒ‡æ¨™
  conversion: {
    signup_30d: number,            // ç›´è¿‘30æ—¥ã®æ–°è¦ç™»éŒ²æ•°
    active_users_30d: number,      // ç›´è¿‘30æ—¥ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
    activation_rate: number,       // active / totalï¼ˆ%ï¼‰
    profile_completion_rate: number, // business_type IS NOT NULLã®å‰²åˆï¼ˆ%ï¼‰â€»Sprint 1å®Œäº†å‰ã¯0
    power_users: number,           // ä»Šæœˆ5ã‚»ãƒƒã‚·ãƒ§ãƒ³ä»¥ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  },

  // Freeåˆ¶é™åˆ°é”çŠ¶æ³ï¼ˆProè»¢æ›å€™è£œï¼‰
  limit_hits: {
    session_limit_hit_users: number,  // ä»Šæœˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸Šé™(3)ã«é”ã—ãŸFreeãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
    image_limit_hit_users: number,    // ä»Šæ—¥ç”»åƒä¸Šé™(3)ã«é”ã—ãŸFreeãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  },

  // æ—¥åˆ¥ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆç›´è¿‘30æ—¥ï¼‰
  daily_signups: Array<{ date: string; count: number }>,
  daily_active: Array<{ date: string; count: number }>,

  // ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ï¼ˆã‚³ãƒ›ãƒ¼ãƒˆç°¡æ˜“ç‰ˆï¼‰
  retention: {
    week1: number,  // ç™»éŒ²1é€±é–“å¾Œã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå‰²åˆï¼ˆ%ï¼‰
    week2: number,
    week4: number,
  },

  // Proè»¢æ›å€™è£œãƒªã‚¹ãƒˆ
  upgrade_candidates: Array<{
    id: string;
    name: string;
    email: string;
    sessions_this_month: number;
    total_images: number;
    created_at: string;
  }>
}
```

**ã‚¯ã‚¨ãƒªè¨­è¨ˆ:**
- `plan_distribution`: usersãƒ†ãƒ¼ãƒ–ãƒ«ã«pro_planã‚«ãƒ©ãƒ ãŒãªã„å ´åˆã€å…¨å“¡Freeã¨ã—ã¦è¿”ã™ã€‚å°†æ¥ã®proå¯¾å¿œã«å‚™ãˆãŸæ§‹é€ 
- `active_users_30d`: `SELECT COUNT(DISTINCT user_id) FROM chat_sessions WHERE created_at > now() - interval '30 days'`
- `profile_completion_rate`: `users WHERE business_type IS NOT NULL AND deleted_at IS NULL` / `users WHERE deleted_at IS NULL` Ã— 100
- `power_users`: ä»Šæœˆã®chat_sessions COUNT >= 5 ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
- `session_limit_hit_users`: ä»Šæœˆã®chat_sessions COUNT = 3 ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆrole != 'admin'ï¼‰
- `retention`: ç™»éŒ²æ—¥ã‹ã‚‰Né€±é–“å¾Œã« `chat_sessions` ãŒã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰²åˆã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå°‘ãªã„å ´åˆã¯0%ã‚’è¿”ã™
- `upgrade_candidates`: session_limit_hit_users ã®è©³ç´°ãƒªã‚¹ãƒˆï¼ˆä¸Šä½20åï¼‰

### 2-2. ãƒšãƒ¼ã‚¸ä½œæˆ: `/admin/revenue/page.tsx`

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨å®šMRR    â”‚ Free/Proæ¯”  â”‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç‡  â”‚ åˆ¶é™åˆ°é”è€…  â”‚
â”‚  Â¥XX,XXX   â”‚  ãƒ‰ãƒ¼ãƒŠãƒ„   â”‚   XX%      â”‚   XXäºº     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  [æ–°è¦ç™»éŒ²ãƒˆãƒ¬ãƒ³ãƒ‰ 30æ—¥]    [DAUãƒˆãƒ¬ãƒ³ãƒ‰ 30æ—¥]         â”‚
â”‚                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è»¢æ›ãƒ•ã‚¡ãƒãƒ«        â”‚ ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³                    â”‚
â”‚ ç™»éŒ² â†’ æœ‰åŠ¹åŒ–      â”‚ 1w: XX%                        â”‚
â”‚   â†’ Power User   â”‚ 2w: XX%                        â”‚
â”‚                   â”‚ 4w: XX%                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Proè»¢æ›å€™è£œä¸€è¦§                                      â”‚
â”‚ [name] [email] [sessions] [images] [ç™»éŒ²æ—¥]          â”‚
â”‚ â†’ ã‚¯ãƒªãƒƒã‚¯ã§ /admin/users/[id] ã«é·ç§»               â”‚
â”‚ (Stripeé€£æºå¾Œã€ã“ã“ã‹ã‚‰æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¯èƒ½ã«ãªã‚Šã¾ã™)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ´»ç”¨:**
- KPIã‚«ãƒ¼ãƒ‰: æ—¢å­˜ `KpiCard` ã‚’æµç”¨
- ãƒ‰ãƒ¼ãƒŠãƒ„: æ—¢å­˜ `CompletionDonut` ã‚’æµç”¨ï¼ˆFree/Proæ¯”ç‡ï¼‰
- ãƒˆãƒ¬ãƒ³ãƒ‰: æ—¢å­˜ `TrendChart` ã‚’æµç”¨
- ãƒ•ã‚¡ãƒãƒ«: æ–°è¦ä½œæˆã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ¨ªæ£’3æ®µã§OK
- ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³: 3ã¤ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã€‚è‰²åˆ†ã‘: â‰¥50%=olive, 30-50%=gold, <30%=warm
- è»¢æ›å€™è£œãƒ†ãƒ¼ãƒ–ãƒ«: æ—¢å­˜ `RecentSessionsTable` ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‚è€ƒã«

### 2-3. ã‚µã‚¤ãƒ‰ãƒŠãƒ“æ›´æ–°
- ã€Œå£²ä¸Šç®¡ç†ã€ã‚’ã€Œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã®ç›´ä¸‹ã«è¿½åŠ 

---

## Task 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç”»é¢ã®æ‹¡å¼µï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

### èƒŒæ™¯
Sprint 1ã§usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ©ãƒ ï¼ˆæ¥­æ…‹ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆãƒ»ã‚«ãƒ©ãƒ¼ç­‰ï¼‰ãŒè¿½åŠ ã•ã‚Œã‚‹æƒ³å®šã€‚adminå´ã§ã‚‚ã“ã‚ŒãŒè¦‹ãˆã‚‹ã¹ãã€‚

### 3-1. APIæ”¹ä¿®: `GET /api/admin/users/[id]`
- selectå¥ã«æ–°ã‚«ãƒ©ãƒ ã‚’è¿½åŠ : `avatar_url, business_type, shop_concept, brand_color_primary, brand_color_secondary, prefecture, website_url, sns_instagram, sns_x`
- Sprint 1ãŒæœªå®Œäº†ã®å ´åˆï¼ˆã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼‰ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã‚ˆã†ã€selectå¥ã‚’å‹•çš„ã«æ§‹ç¯‰ã™ã‚‹ã‹ã€try-catchã§å¯¾å¿œ

### 3-2. ãƒšãƒ¼ã‚¸æ”¹ä¿®: `/admin/users/[id]/page.tsx`

**ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ã«è¿½åŠ è¡¨ç¤º:**
- æ¥­æ…‹: ãƒãƒƒã‚¸è¡¨ç¤ºï¼ˆä¾‹: `ã‚«ãƒ•ã‚§`ï¼‰ã€‚null ã®å ´åˆã€Œæœªè¨­å®šã€ã‚°ãƒ¬ãƒ¼ãƒãƒƒã‚¸
- åº—èˆ—ã‚³ãƒ³ã‚»ãƒ—ãƒˆ: ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ200æ–‡å­—ä»¥å†…ï¼‰ã€‚null ã®å ´åˆã€Œâ€”ã€
- ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼: ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ— `â–  #E8713A` ã®ã‚ˆã†ãªè‰²ä»˜ãè¡¨ç¤ºã€‚ãƒ¡ã‚¤ãƒ³ + ã‚µãƒ–
- éƒ½é“åºœçœŒ: ãƒ†ã‚­ã‚¹ãƒˆ
- Webã‚µã‚¤ãƒˆURL: ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãƒªãƒ³ã‚¯ï¼ˆæ–°è¦ã‚¿ãƒ–ï¼‰
- SNS: Instagram / X ã®ãƒãƒ³ãƒ‰ãƒ«è¡¨ç¤º

**è¡¨ç¤ºä½ç½®:** æ—¢å­˜ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ï¼ˆName, Email, Role, Status, Registration, Last Activeï¼‰ã®ä¸‹ã«ã€Œåº—èˆ—æƒ…å ±ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¿½åŠ 

---

## Task 4: adminãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰KPIæ‹¡å¼µï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

### 4-1. APIæ”¹ä¿®: `GET /api/admin/stats`

æ—¢å­˜ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«è¿½åŠ :

```typescript
{
  // ...æ—¢å­˜KPI...

  gallery: {
    total_shared: number,
    total_likes: number,
    total_saves: number,
    pending_reports: number,
  },
  profile_completion_rate: number, // %ï¼ˆSprint 1å®Œäº†å‰ã¯0ï¼‰
}
```

### 4-2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UIæ”¹ä¿®: `/admin/page.tsx`

**æ—¢å­˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆKPI + ãƒˆãƒ¬ãƒ³ãƒ‰ + å®Œäº†ç‡ + æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ + APIå¥å…¨æ€§ï¼‰ã®å¾Œã«è¿½åŠ :**

**ã‚®ãƒ£ãƒ©ãƒªãƒ¼çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- 4ã¤ã®å°ã‚«ãƒ¼ãƒ‰æ¨ªä¸¦ã³: å…¬é–‹ç”»åƒæ•° / ã„ã„ã­æ•° / ä¿å­˜æ•° / æœªå¯¾å¿œé€šå ±æ•°
- æœªå¯¾å¿œé€šå ± â‰¥ 1 ã®å ´åˆ: èµ¤è‰² + ã€Œãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ã¸ â†’ã€ãƒªãƒ³ã‚¯
- æœªå¯¾å¿œé€šå ± = 0 ã®å ´åˆ: oliveè‰² + ã€Œé€šå ±ãªã—ã€

**ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šç‡:**
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆç›®æ¨™60%ã®ãƒãƒ¼ã‚«ãƒ¼ä»˜ãï¼‰
- ã€ŒXX% (YY/ZZäºº)ã€ã®ãƒ©ãƒ™ãƒ«

---

## Task 5: APIåˆ©ç”¨ãƒ­ã‚°ã®æ”¹å–„ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰

**ç¾çŠ¶:** ãƒ•ã‚£ãƒ«ã‚¿ãªã—ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã€ç›´è¿‘100ä»¶å›ºå®šã€‚

### 5-1. APIæ”¹ä¿®: `GET /api/admin/api-logs`

ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ :
- `page`: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ20ä»¶/ãƒšãƒ¼ã‚¸ï¼‰
- `status`: `success` | `error` ãƒ•ã‚£ãƒ«ã‚¿
- `api_type`: `chat` | `image_gen` ãƒ•ã‚£ãƒ«ã‚¿
- `from` / `to`: ISOæ—¥ä»˜æ–‡å­—åˆ—ã§æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿

### 5-2. UIæ”¹ä¿®: `/admin/api-logs/page.tsx`

- ãƒ•ã‚£ãƒ«ã‚¿ãƒãƒ¼è¿½åŠ ï¼ˆä¸Šéƒ¨ã«æ¨ªä¸¦ã³ï¼‰:
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å…¨ã¦ / æˆåŠŸã®ã¿ / ã‚¨ãƒ©ãƒ¼ã®ã¿ï¼ˆãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
  - APIã‚¿ã‚¤ãƒ—: å…¨ã¦ / Chat / Imageï¼ˆãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
  - æœŸé–“: éå»24æ™‚é–“ / 7æ—¥ / 30æ—¥ï¼ˆã‚»ãƒ¬ã‚¯ãƒˆï¼‰
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- ã‚¨ãƒ©ãƒ¼è¡Œã‚’ `bg-red-50` ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ

---

## Task 6: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¿½åŠ ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

### èƒŒæ™¯
`POST /api/signup` ã«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒãªãã€å¤§é‡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãŒå¯èƒ½ãªçŠ¶æ…‹ã€‚ç¤¾å†…ãƒ‡ãƒ¢ç”¨é€”ã§ã‚‚æœ€ä½é™ã®é˜²å¾¡ã¯å¿…è¦ã€‚

### 6-1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¿½åŠ 

æ—¢å­˜ã® `src/lib/rate-limiter.ts` ã‚’ç¢ºèªã—ã€åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ `/api/signup` ã«ã‚‚é©ç”¨:

```typescript
// signupç”¨: åŒä¸€IPã‹ã‚‰ 3å›/10åˆ†
// æ—¢å­˜ã®rate-limiterã®ä»•çµ„ã¿ã‚’æµç”¨
```

**å®Ÿè£…ç®‡æ‰€:** `src/app/api/signup/route.ts` ã®POSTãƒãƒ³ãƒ‰ãƒ©å†’é ­ã«ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{ "error": "ç™»éŒ²ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚" }
```
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 429

### 6-2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”»é¢ã®æ•´ç†

ç¾åœ¨ã® `/forgot-password` ã¯ UIã ã‘ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ã€‚ãƒ‡ãƒ¢æ™‚ã«æ··ä¹±ã‚’æ‹›ãã€‚

**å¯¾å¿œæ–¹é‡:**
- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã§ã™ã‹ï¼Ÿã€ãƒªãƒ³ã‚¯ã¯æ®‹ã™ï¼ˆå­˜åœ¨ã—ãªã„ã¨ä¸è‡ªç„¶ï¼‰
- `/forgot-password` ãƒšãƒ¼ã‚¸ã®é€ä¿¡å¾Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ”¹å–„:
  - ç¾åœ¨: ã€Œâ€» ç¾åœ¨ãƒ‡ãƒ¢ç‰ˆã®ãŸã‚ã€å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã€
  - å¤‰æ›´: ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã¯ç¾åœ¨æº–å‚™ä¸­ã§ã™ã€‚ãŠæ‰‹æ•°ã§ã™ãŒç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ã€+ ç®¡ç†è€…é€£çµ¡å…ˆï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ or ç¤¾å†…ãƒãƒ£ãƒƒãƒˆç­‰ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã€å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã¯è¡Œã‚ãªã„ï¼ˆç¾åœ¨ã¨åŒã˜ï¼‰

### 6-3. ç™»éŒ²å¾Œã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å°ç·š

ç¾åœ¨: ç™»éŒ²å®Œäº† â†’ `/dashboard` ã«ç›´è¡Œï¼ˆä½•ã‚’ã™ã¹ãã‹ã‚ã‹ã‚‰ãªã„ï¼‰

**æ”¹å–„:**
- ç™»éŒ²å®Œäº†å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã‚’ `/dashboard` ã®ã¾ã¾ç¶­æŒ
- ãŸã ã—ã€**åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼ˆ`onboarding_completed_at` ãŒnullã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰** ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸Šã§ç°¡æ˜“ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ ã‚ˆã†ã“ã MenuCraft AI ã¸ï¼       â”‚
â”‚                                     â”‚
â”‚  ãƒãƒ£ãƒƒãƒˆã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒã‚’             â”‚
â”‚  è‡ªå‹•ç”Ÿæˆã§ãã¾ã™ã€‚                   â”‚
â”‚                                     â”‚
â”‚  [æœ€åˆã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œã‚‹ â†’]   [å¾Œã§]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ã€Œæœ€åˆã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œã‚‹ â†’ã€: `/chat` ã«é·ç§»
- ã€Œå¾Œã§ã€: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã€`PATCH /api/account` ã§ `onboarding_completed_at` ã‚’ç¾åœ¨æ—¥æ™‚ã«æ›´æ–°
- **æ—¢å­˜ã® `OnboardingTour` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`src/components/onboarding/OnboardingTour.tsx`) ã‚’ç¢ºèªã—ã€æµç”¨å¯èƒ½ã§ã‚ã‚Œã°ãã‚Œã‚’æ´»ç”¨ã™ã‚‹**

---

## adminã‚µã‚¤ãƒ‰ãƒŠãƒ“æœ€çµ‚æ§‹æˆ

```
â—‹ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰       /admin
â—‹ å£²ä¸Šç®¡ç†            /admin/revenue        â† æ–°è¦ (Task 2)
â—‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§       /admin/sessions
â—‹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†         /admin/users
â—‹ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³       /admin/moderation     â† æ–°è¦ (Task 1)
â—‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†       /admin/prompts
â—‹ å‚è€ƒç”»åƒ            /admin/references
â—‹ APIåˆ©ç”¨ãƒ­ã‚°         /admin/api-logs
```

---

## å®Œäº†åŸºæº–

- [ ] `npm run build` ãŒã‚¨ãƒ©ãƒ¼ãªãé€šã‚‹
- [ ] `npm test` ãŒå…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹
- [ ] `/admin/moderation` ã§é€šå ±ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã€éå…¬é–‹/å´ä¸‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã™ã‚‹
- [ ] `/admin/revenue` ã§æ¨å®šMRRãƒ»ãƒ—ãƒ©ãƒ³åˆ†å¸ƒãƒ»è»¢æ›ãƒ•ã‚¡ãƒãƒ«ãƒ»ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãƒ»è»¢æ›å€™è£œãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] `/admin/users/[id]` ã§åº—èˆ—ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆSprint 1æœªå®Œäº†ã®å ´åˆã¯nullè¡¨ç¤ºã§å¯ï¼‰
- [ ] adminãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚®ãƒ£ãƒ©ãƒªãƒ¼çµ±è¨ˆ + ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šç‡ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- [ ] APIåˆ©ç”¨ãƒ­ã‚°ã«ãƒ•ã‚£ãƒ«ã‚¿ + ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ï¼ˆTask 5ã‚¹ã‚­ãƒƒãƒ—ã®å ´åˆã¯é™¤å¤–ï¼‰
- [ ] `POST /api/signup` ã«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹
- [ ] `/forgot-password` ãŒã€Œæº–å‚™ä¸­ã€ã®é©åˆ‡ãªæ¡ˆå†…ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã€ãƒãƒ£ãƒƒãƒˆã¸ã®å°ç·šãŒã‚ã‚‹
- [ ] adminã‚µã‚¤ãƒ‰ãƒŠãƒ“ãŒ8é …ç›®ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ä½œæ¥­ã‚’ `feature/admin-enhancement` ãƒ–ãƒ©ãƒ³ãƒã§è¡Œã„ã€developã¸ã®PRã‚’ä½œæˆ

---

## å·¥æ•°è¦‹ç©ãƒ»å„ªå…ˆé †ä½

**åˆè¨ˆ: 3ã€œ4æ—¥**

| é †åº | ã‚¿ã‚¹ã‚¯ | å·¥æ•° | ã‚¹ã‚­ãƒƒãƒ—å¯ |
|:---:|--------|:---:|:---:|
| 1 | Task 1: ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ | M | âœ— |
| 2 | Task 2: å£²ä¸Šç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | L | âœ— |
| 3 | Task 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°æ‹¡å¼µ | S | âœ— |
| 4 | Task 6: ç™»éŒ²ãƒ•ãƒ­ãƒ¼æ”¹å–„ | M | âœ— |
| 5 | Task 4: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰KPIæ‹¡å¼µ | S | â—‹ |
| 6 | Task 5: APIãƒ­ã‚°æ”¹å–„ | M | â—‹ |

æ™‚é–“ä¸è¶³ã®å ´åˆ: Task 4ãƒ»5 ã¯æ¬¡å›Sprintã«å›ã—ã¦OKã€‚
