# 飲食店メニュー画像生成Webサービス 要件定義書

**プロジェクト名（仮）**: MenuCraft AI
**作成日**: 2025-02-09
**ステータス**: ドラフト v1.0

---

## 1. プロダクト概要

### 1.1 サービスコンセプト
飲食店オーナーが、専門的なデザイン知識がなくても、チャット形式の対話を通じて**店舗メニュー画像**や**SNS投稿用ビジュアル**をセルフで生成できるWebサービス。

### 1.2 解決する課題

| 課題 | 現状 | 本サービスでの解決 |
|------|------|-------------------|
| デザインコスト | メニューデザインを外注すると1件あたり数万円〜 | AIによるセルフ生成で大幅にコスト削減 |
| SNS運用の負荷 | 各プラットフォームのサイズに合わせた画像作成が手間 | 3サイズ同時生成（Instagram/X） |
| 専門知識の壁 | Photoshop等のスキルが必要 | チャットで日本語で伝えるだけ |
| 更新の即時性 | 外注だと修正に数日かかる | その場で生成・修正が可能 |

### 1.3 マネタイズ・料金プラン

| | Free プラン | Pro プラン |
|---|---|---|
| 月額料金 | ¥0 | ¥700 |
| 対応サイズ | Instagram フィード (1:1) のみ | 3サイズ全対応 (1:1 / 9:16 / 16:9) |
| 画像生成枚数 | 1日3枚まで | 無制限 |
| 生成履歴保存 | 直近3件まで | 無制限 |
| チャットヒアリング | ✅ | ✅ |
| キャッチコピー・ハッシュタグ提案 | ✅ | ✅ |

**エンタープライズ（店舗専用プラン）:**
- 個別見積もり
- 複数店舗一括導入、オリジナルテンプレート作成、ブランドガイドライン反映等
- お問い合わせフォームからの相談対応

### 1.4 想定ユーザー
**飲食店オーナー・店長（個人経営〜小規模チェーン）**

- ITリテラシー：スマートフォン・SNSは日常的に使用、専門ツールは不慣れ
- 年齢層：30〜60代
- 利用シーン：新メニュー追加時、季節メニュー変更時、SNSキャンペーン時

---

## 2. 機能要件

### 2.1 コア機能一覧

| # | 機能名 | 優先度 | MVP対象 |
|---|--------|--------|---------|
| F-01 | チャットベースのヒアリング | 高 | ✅ |
| F-02 | 料理写真アップロード・分析 | 高 | ✅ |
| F-03 | 構成案テキスト生成（キャッチコピー・ハッシュタグ） | 高 | ✅ |
| F-04 | マルチサイズ画像生成（1:1 / 9:16 / 16:9） | 高 | ✅ |
| F-05 | 生成画像プレビュー | 高 | ✅ |
| F-06 | 生成画像ダウンロード（個別・一括ZIP） | 高 | ✅ |
| F-07 | ユーザー認証（サインアップ / ログイン） | 中 | ✅ |
| F-08 | 生成履歴の保存・閲覧 | 中 | ✅ |
| F-09 | 画像リトライ（最大3回） | 中 | ✅ |
| F-10 | 料金プラン管理（Free/Pro切替） | 高 | ✅ |
| F-11 | ランディングページ（プラン説明・事例・問い合わせ） | 高 | ✅ |
| F-12 | テンプレート選択（業態別） | 低 | ❌（Phase 2） |
| F-13 | チーム共有・マルチアカウント | 低 | ❌（Phase 2） |
| F-14 | 生成画像のテキスト編集（Canva連携等） | 低 | ❌（Phase 2） |
| F-15 | エンタープライズプラン（店舗専用カスタマイズ） | 低 | ❌（Phase 3） |

### 2.2 機能詳細

#### F-01: チャットベースのヒアリング
AIがステップバイステップで以下の情報を収集する。

**収集項目:**
1. 店名
2. 業態（居酒屋、フレンチ、カフェ、ラーメン店 など）
3. お店のコンセプト・雰囲気
4. イメージカラー・デザインの好み（ポップ/シック/和風/モダン/ナチュラル等）
5. 料理写真（任意、10MB以内）
6. メニューリスト・価格
7. 看板メニュー（特に推したい料理）

**ヒアリングUXルール:**
- 1回の質問は1〜2項目に絞り、ユーザーを圧倒しない
- 未回答の項目はやさしくリマインドする
- 写真がない場合でもテキスト情報だけで進行可能であることを明示する

#### F-02: 料理写真アップロード・分析
- 対応フォーマット: JPEG, PNG, WebP
- 最大ファイルサイズ: 10MB
- 10MB超過時: リサイズを促すメッセージを表示
- 分析内容: 色味、質感、盛り付けスタイルをテキストで要約し、画像生成プロンプトに反映

#### F-03: 構成案テキスト生成
チャット内でテキストベースの構成案を提示し、ユーザー承認後に画像生成に進む。

**出力項目:**
- メニューカテゴリー分け
- キャッチコピー案（2〜3パターン）
- SNS用ハッシュタグ案（5〜10個）
- デザインの方向性（カラートーン、雰囲気の説明）

#### F-04: マルチサイズ画像生成
構成案の合意後、3サイズで同時生成。

| 用途 | アスペクト比 | 構図のポイント |
|------|-------------|---------------|
| Instagram フィード | 1:1 | 中央配置、余白バランス |
| Instagram ストーリーズ | 9:16 | フルブリード、縦方向のフロー |
| X (Twitter) | 16:9 | インパクトのある水平構図、三分割法 |

#### F-05 / F-06: プレビュー & ダウンロード
- プレビュー: 3サイズを並列またはタブ切り替えで表示
- ダウンロード: 個別PNG + 一括ZIPダウンロード
- ファイル名規則: `{店名}_{用途}_{日時}.png`（例: `sakura_cafe_instagram_feed_20250209.png`）

#### F-07: ユーザー認証
- メールアドレス + パスワードによるサインアップ/ログイン
- **ランディングページからのクイック登録**: ヒーローセクションのメールアドレス入力欄からサインアップ画面（S-02）に遷移し、メールアドレスを自動入力。パスワード設定のみで登録完了。
- パスワードリセット機能
- （デモ段階では簡易認証で可。本番ではOAuth対応も検討）

#### F-08: 生成履歴の保存・閲覧
- ユーザーごとに過去の生成セッションを保存
- 各セッションに紐づく情報: 入力情報、構成案、生成画像、生成日時
- 履歴一覧からの再ダウンロード対応

#### F-09: 画像リトライ
- 1セッションにつき最大3回まで再生成可能
- 残りリトライ回数をUIに表示
- 3回超過時: 「方向性を見直しましょう」としてヒアリングに戻る導線を提供

#### F-10: 料金プラン管理
- Freeプランはデフォルト（サインアップ直後）
- Proプランへのアップグレード導線をダッシュボードとチャット画面に表示
- Freeプランのユーザーが3サイズ生成を試みた場合: Proプランへの案内を表示
- Freeプランの日次制限（3枚/日）到達時: 制限メッセージ + Pro案内を表示
- Freeプランの履歴上限（3件）到達時: 古い履歴を表示不可にし、Pro案内を表示
- 決済連携は Phase 3（デモ段階ではプランフラグの切替のみ）

#### F-11: ランディングページ
以下のセクションで構成:
- **ヒーロー**: サービス概要、メールアドレス入力欄によるクイック登録CTA、料金プランへのスクロールリンク
  - メールアドレス入力欄 + 「無料ではじめる →」ボタン
  - 「🔒 クレジットカード不要・30秒で登録完了」の安心メッセージ
  - 送信時: メールアドレスを引き継いでサインアップ画面（S-02）に遷移
  - バリデーション: `@` を含む有効なメールアドレスであること
- **特徴カード**: チャットヒアリング / 3サイズ生成 / 即ダウンロードの3点訴求
- **導入事例**: 3店舗の事例カード（業態・成果・生成画像サイズ・ハッシュタグ）
- **料金プラン**: Free / Pro の比較表（各プランのCTAボタンはヒーローのメール入力欄にスクロール）
- **フッター**: お問い合わせフォーム（店舗専用プラン向け）+ 連絡先情報 + 法的リンク

お問い合わせフォーム項目:
1. お名前（必須）
2. 店舗名（必須）
3. メールアドレス（必須）
4. 業態（任意 / セレクト）
5. 店舗数（任意 / セレクト）
6. お問い合わせ内容（必須 / テキストエリア）

---

## 3. 画面構成（ワイヤーフレーム概要）

### 3.1 画面一覧

| # | 画面名 | パス | 説明 |
|---|--------|------|------|
| S-01 | ランディングページ | `/` | ヒーロー（メール入力CTA）、特徴、導入事例、料金プラン、お問い合わせフォーム |
| S-02 | サインアップ | `/signup` | メール（ランディングから引継ぎ可）・パスワード登録 |
| S-03 | ログイン | `/login` | メール・パスワード認証 |
| S-04 | ダッシュボード | `/dashboard` | 生成履歴一覧、統計、新規作成ボタン、プラン表示 |
| S-05 | チャット（メイン） | `/chat` | ヒアリング〜画像生成の一気通貫チャットUI |
| S-06 | 生成結果・プレビュー | `/chat` 内 | 3サイズプレビュー、ダウンロードボタン |
| S-07 | 履歴詳細 | `/history/{session_id}` | 過去セッションの詳細・再ダウンロード |

### 3.2 メイン画面（チャット）のUI構成

```
┌─────────────────────────────────────────┐
│  ヘッダー: ロゴ / ダッシュボードへ戻る    │
├─────────────────────────────────────────┤
│                                         │
│  チャットエリア                          │
│  ┌─────────────────────────────────┐    │
│  │ 🤖 はじめまして！お店の情報を     │    │
│  │    教えてください。まず店名は？   │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ 👤 「さくらカフェ」です          │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ 🤖 ありがとうございます！        │    │
│  │    業態を教えてください。        │    │
│  │    [カフェ] [居酒屋] [和食]      │    │
│  │    [イタリアン] [その他]         │    │
│  └─────────────────────────────────┘    │
│                                         │
│  --- 画像生成後 ---                      │
│  ┌─────────────────────────────────┐    │
│  │ 🤖 3サイズの画像が完成しました！  │    │
│  │ [1:1] [9:16] [16:9] タブ切替     │    │
│  │ ┌───────────────────────────┐    │    │
│  │ │     画像プレビュー        │    │    │
│  │ └───────────────────────────┘    │    │
│  │ [📥 個別DL] [📦 一括ZIP DL]     │    │
│  │ 残りリトライ: 3/3回              │    │
│  │ [🔄 修正を依頼する]             │    │
│  └─────────────────────────────────┘    │
│                                         │
├─────────────────────────────────────────┤
│  [📎 写真] [入力欄________________] [送信]│
└─────────────────────────────────────────┘
```

---

## 4. システムアーキテクチャ

### 4.1 技術スタック

| レイヤー | 技術 | 備考 |
|----------|------|------|
| フロントエンド | Streamlit | Python軽量UIフレームワーク |
| バックエンド | Python 3.11+ | Streamlit内蔵 + 追加ロジック |
| LLM（チャット） | Google Gemini API | ヒアリング・構成案生成 |
| 画像生成 | nano banana pro（Google AI Studio経由） | メニュー画像生成 |
| データベース | SQLite（デモ）→ PostgreSQL（本番） | ユーザー・履歴管理 |
| 認証 | streamlit-authenticator | 簡易認証（デモ用） |
| ファイルストレージ | ローカル（デモ）→ Cloud Storage（本番） | 生成画像保存 |
| デプロイ | Streamlit Cloud（デモ） | 無料枠で検証可能 |

### 4.2 アーキテクチャ概要図

```
┌──────────┐     ┌─────────────────────────────────┐
│  ユーザー │────▶│  Streamlit App                  │
│ (ブラウザ)│◀────│                                 │
└──────────┘     │  ┌───────────┐  ┌────────────┐  │
                 │  │ Chat UI   │  │ Preview UI │  │
                 │  └─────┬─────┘  └─────┬──────┘  │
                 │        │              │          │
                 │  ┌─────▼──────────────▼──────┐  │
                 │  │   Session Manager          │  │
                 │  │   (State / History)        │  │
                 │  └─────┬──────────────┬──────┘  │
                 └────────┼──────────────┼─────────┘
                          │              │
                 ┌────────▼───┐  ┌───────▼────────┐
                 │ Gemini API │  │ nano banana pro│
                 │ (Chat/LLM) │  │ (Image Gen)    │
                 └────────────┘  └────────────────┘
                          │              │
                 ┌────────▼──────────────▼─────────┐
                 │  SQLite DB + File Storage        │
                 │  (Users / Sessions / Images)     │
                 └─────────────────────────────────┘
```

### 4.3 データモデル

#### users テーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | TEXT (UUID) | 主キー |
| email | TEXT | メールアドレス（UNIQUE） |
| password_hash | TEXT | ハッシュ化パスワード |
| display_name | TEXT | 表示名 |
| plan | TEXT | free / pro（デフォルト: free） |
| daily_generation_count | INTEGER | 当日の生成枚数（Freeプラン制限用） |
| daily_count_reset_at | DATE | 日次カウントリセット日 |
| created_at | DATETIME | 作成日時 |
| updated_at | DATETIME | 更新日時 |

#### contact_inquiries テーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | TEXT (UUID) | 主キー |
| name | TEXT | お名前 |
| shop_name | TEXT | 店舗名 |
| email | TEXT | メールアドレス |
| business_type | TEXT | 業態（任意） |
| shop_count | TEXT | 店舗数（任意） |
| message | TEXT | お問い合わせ内容 |
| status | TEXT | new / in_progress / resolved |
| created_at | DATETIME | 作成日時 |

#### sessions テーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | TEXT (UUID) | 主キー |
| user_id | TEXT (FK) | ユーザーID |
| shop_name | TEXT | 店名 |
| business_type | TEXT | 業態 |
| concept | TEXT | コンセプト |
| design_preference | TEXT | デザインの好み |
| menu_data | JSON | メニューリスト・価格 |
| signature_dish | TEXT | 看板メニュー |
| catchcopy | TEXT | 承認済みキャッチコピー |
| hashtags | JSON | ハッシュタグリスト |
| retry_count | INTEGER | リトライ回数（0〜3） |
| status | TEXT | in_progress / completed |
| created_at | DATETIME | 作成日時 |
| updated_at | DATETIME | 更新日時 |

#### generated_images テーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | TEXT (UUID) | 主キー |
| session_id | TEXT (FK) | セッションID |
| image_type | TEXT | instagram_feed / instagram_story / x_post |
| file_path | TEXT | 画像ファイルパス |
| prompt_used | TEXT | 使用した英語プロンプト |
| generation_number | INTEGER | 生成回数（1〜4） |
| created_at | DATETIME | 作成日時 |

#### uploaded_photos テーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | TEXT (UUID) | 主キー |
| session_id | TEXT (FK) | セッションID |
| file_path | TEXT | アップロード画像パス |
| file_size_bytes | INTEGER | ファイルサイズ |
| analysis_result | TEXT | AI分析結果テキスト |
| created_at | DATETIME | 作成日時 |

---

## 5. API設計

### 5.1 外部API連携

#### Google Gemini API（チャット）
- 用途: ヒアリング対話、構成案生成、キャッチコピー生成
- モデル: gemini-2.0-flash（またはプロジェクトに適したモデル）
- システムプロンプト: 前工程で作成済みのメニューデザイナープロンプトを使用

#### nano banana pro（画像生成）
- 用途: メニュー画像生成
- 呼び出し: Google AI Studio API経由
- プロンプト: Gemini APIがヒアリング結果から英語プロンプトを構築→画像生成APIに渡す

### 5.2 内部APIフロー

```
1. ユーザーメッセージ送信
   └→ Gemini API: ヒアリング対話（システムプロンプト適用）
      └→ レスポンスをチャットに表示

2. ヒアリング完了・構成案承認
   └→ Gemini API: 英語画像生成プロンプト構築
      └→ nano banana pro: 3サイズで画像生成
         └→ 画像をストレージに保存
            └→ プレビューをチャットに表示

3. リトライリクエスト
   └→ retry_count チェック（≤3）
      └→ Gemini API: 修正指示を反映したプロンプト再構築
         └→ nano banana pro: 再生成
```

---

## 6. 非機能要件

| 項目 | デモ（MVP） | 本番目標 |
|------|------------|----------|
| 同時接続数 | 1〜5ユーザー | 100ユーザー |
| 画像生成時間 | 30秒以内 | 15秒以内 |
| 可用性 | ベストエフォート | 99.5% |
| データ保持期間 | セッション中 | 無期限（有料プラン） |
| セキュリティ | 簡易認証 | OAuth 2.0 + HTTPS |
| レスポンシブ | PC優先 | PC + スマートフォン |

---

## 7. 開発フェーズ

### Phase 1: デモ（MVP）— 目標: 2〜3週間
- [x] システムプロンプト完成
- [x] 要件定義書作成
- [x] UIモックアップ作成
- [ ] Streamlit基盤セットアップ
- [ ] ランディングページ実装（ヒーロー・事例・料金プラン・問い合わせフォーム）
- [ ] チャットUI実装（Gemini API連携）
- [ ] 画像アップロード機能
- [ ] 画像生成パイプライン（nano banana pro連携）
- [ ] 3サイズプレビュー・ダウンロード
- [ ] 簡易認証（streamlit-authenticator）
- [ ] プラン管理（Free/Proフラグ切替 + 制限ロジック）
- [ ] 生成履歴（SQLite）
- [ ] お問い合わせフォーム（DB保存）
- [ ] Streamlit Cloudデプロイ

### Phase 2: 改善 — Phase 1完了後
- [ ] 業態別テンプレート
- [ ] UI/UXブラッシュアップ（レスポンシブ対応）
- [ ] 生成品質の向上（プロンプトチューニング）
- [ ] エラーハンドリング強化

### Phase 3: 本番化 — 需要検証後
- [ ] PostgreSQL移行
- [ ] Cloud Storage移行
- [ ] OAuth認証
- [ ] 決済連携（Stripe等）によるPro課金
- [ ] エンタープライズプラン対応
- [ ] チーム共有機能
- [ ] Canva/Figma連携

---

## 8. リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| 画像内の日本語テキストが崩れる | ユーザー体験低下 | 「コンセプト案」として明示 + テキスト情報は別途テキストで提供 |
| 画像生成APIのレート制限 | 生成失敗・遅延 | リトライロジック + キュー管理 + ユーザーへの待ち時間表示 |
| Geminiの応答品質のブレ | 不適切なプロンプト生成 | Few-shot例をシステムプロンプトに含める + 出力バリデーション |
| アップロード画像の著作権 | 法的リスク | 利用規約で「ユーザー自身の写真のみ使用」を明記 |
| 生成画像の商用利用権 | 法的リスク | 画像生成エンジンの利用規約を確認・明記 |

---

## 9. 用語集

| 用語 | 説明 |
|------|------|
| シズル感 | 料理写真で食欲をそそる視覚効果（湯気、光沢、みずみずしさ等） |
| フルブリード | 画像が余白なく端まで広がるレイアウト |
| パワーワード | SNSでスクロールを止める強い訴求力のある言葉 |
| nano banana pro | 本プロジェクトで使用する画像生成エンジン |
| ヒアリング | AIがチャットで店舗・メニュー情報を収集するプロセス |

---

*本要件定義書はドラフトです。レビュー・フィードバックを反映して更新します。*
