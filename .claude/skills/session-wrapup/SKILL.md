---
name: session-wrapup
description: 開発セッション終了時にドキュメント群を最新状態に同期し、作業記録を出力する
disable-model-invocation: true
allowed-tools: Bash, Read, Grep, Glob, Edit, Write, Task
---

# /session-wrapup — セッション終了時のドキュメント同期

開発セッションの作業内容を整理し、プロジェクトドキュメントを最新状態に更新してください。

## 処理手順

### Step 1: 変更内容の収集

以下を並列で収集:

1. **今セッションのコミット**: `git log --oneline develop..HEAD` または直近のコミット群
2. **変更ファイル一覧**: `git diff --stat develop` または `git diff --name-status`
3. **作成したPR**: `gh pr list --author @me --state all --limit 5`
4. **作成/クローズしたIssue**: `gh issue list --state all --limit 20` から今日の日付でフィルタ
5. **現在のブランチ状態**: `git branch -v` でプッシュ状況確認

### Step 2: CLAUDE.md の更新

CLAUDE.md を読み、以下のセクションを更新が必要か判断:

#### 2a. 技術的負債セクション
- 今セッションで解消した負債があれば ~~打ち消し~~ + DONE に更新
- 新たに発見した負債があれば追加

#### 2b. ディレクトリ構成
- 新しいディレクトリやファイルカテゴリが増えた場合のみ更新
- 例: `src/__tests__/` が追加された、新しいhooksディレクトリができた等

#### 2c. APIエンドポイント
- 新しいAPIが追加された場合、テーブルに追記
- エンドポイント数の更新

#### 2d. 次回セッションのタスク
- 完了したタスクを削除または完了マーク
- 今セッションで見えた新タスクを追加
- 優先度の変更があれば反映

#### 2e. データベース構成
- 新テーブルや新カラムが追加された場合に更新

**注意**: 変更がないセクションは触らない。差分を最小限に保つ。

### Step 3: 作業記録の出力

以下のフォーマットでセッションサマリーを生成し、ユーザーに表示:

```markdown
## セッション作業記録 — YYYY-MM-DD

### ブランチ
- 作業ブランチ: `branch-name`
- マージ先: develop / main

### コミット一覧
| Hash | メッセージ |
|------|----------|
| abc1234 | feat: ... |

### 作成したPR
- #XX タイトル (状態)

### 作成/更新したIssue
- #XX タイトル (作成 / クローズ)

### 実装サマリー
- [箇条書きで何を実装/変更したか]

### 更新したドキュメント
- CLAUDE.md（更新箇所のリスト）
- その他

### 残タスク・ブロッカー
- [未完了の作業や次回への引き継ぎ事項]

### 次回セッションへの提案
1. [最優先でやるべきこと]
2. [次にやるべきこと]
```

### Step 4: 関連ドキュメントの更新チェック

1. `docs/` 配下のプランニングドキュメントを確認
2. 今セッションの作業に関連するドキュメントがあれば、進捗を反映すべきか判断
3. 更新が必要な場合はユーザーに確認してから更新

### Step 5: コミット（ユーザー確認後）

ドキュメント更新がある場合:
1. 変更差分をユーザーに提示
2. 承認を得てからコミット
3. コミットメッセージ: `docs: session wrapup — YYYY-MM-DD`

## 重要な注意事項

- CLAUDE.md の更新は **変更があったセクションのみ**。無駄な差分を作らない
- 作業記録はユーザーへの表示のみ（ファイルに保存するかはユーザーに確認）
- Notion等の外部ツール連携がある場合は、MCPツールの利用を試みる
- コミットはユーザーの明示的な承認後にのみ実行
